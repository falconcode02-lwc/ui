<nz-page-header class="page-action" nzSize="small">
    <nz-page-header-title>
        <nz-icon nzType="key" nzTheme="outline"></nz-icon>
        Secret Manager
    </nz-page-header-title>
    <nz-page-header-subtitle>

    </nz-page-header-subtitle>
    <nz-page-header-extra>
        <nz-space>
            <nz-input-group *nzSpaceItem [nzPrefix]="prefixIconSearch" style="width: 200px;">
                <input type="text" nz-input placeholder="Search Secrets" [(ngModel)]="searchQuery"
                    (ngModelChange)="onSearchChange($event)" />
            </nz-input-group>
            <ng-template #prefixIconSearch>
                <span nz-icon nzType="search"></span>
            </ng-template>
            <button *nzSpaceItem nz-button nzShape="round" nzType="primary" (click)="openCreate()"> <span nz-icon
                    nzType="plus" nzTheme="outline"></span> Add Credential</button>
        </nz-space>
    </nz-page-header-extra>
</nz-page-header>

<div class="secrets-root">
    <div class="secrets-list">
        <!-- Empty State -->
        <nz-empty *ngIf="!loading && secrets.length === 0" nzNotFoundContent="No secrets found">
        </nz-empty>

        <!-- List View -->
        <nz-list *ngIf="secrets.length > 0" [nzDataSource]="paginatedSecrets" nzBordered>
            <nz-list-item *ngFor="let s of paginatedSecrets" class="secret-item">
                <div class="secret-content">
                    <div class="secret-main" (click)="openEdit(s)">
                        <nz-icon nzType="key" nzTheme="outline" class="secret-icon"></nz-icon>
                        <div class="secret-details">
                            <div class="secret-name">{{ s.name }}</div>
                            <div class="secret-meta">
                                <span class="meta-item">
                                    <span class="meta-label">Type:</span> {{ s.type }}
                                </span>
                                <span class="meta-item">
                                    <span class="meta-label">|</span> Updated: {{ formatDate(s.updatedAt) }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="secret-actions">
                        <button nz-button nzType="text" nz-dropdown [nzDropdownMenu]="menu" nzPlacement="bottomRight"
                            (click)="$event.stopPropagation()">
                            <nz-icon nzType="more" nzTheme="outline"></nz-icon>
                        </button>
                        <nz-dropdown-menu #menu="nzDropdownMenu">
                            <ul nz-menu>
                                <li nz-menu-item (click)="openEdit(s)">
                                    <span nz-icon nzType="edit" nzTheme="outline"></span>
                                    Edit
                                </li>
                                <li nz-menu-item nzDanger nz-popconfirm nzPopconfirmTitle="Are you sure?"
                                    (nzOnConfirm)="confirmDelete(s.id)">
                                    <span nz-icon nzType="delete" nzTheme="outline"></span>
                                    Delete
                                </li>
                            </ul>
                        </nz-dropdown-menu>
                    </div>
                </div>
            </nz-list-item>
        </nz-list>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="secrets.length > 0">
            <nz-pagination [nzPageIndex]="pageIndex" [nzTotal]="filteredSecrets.length" [nzPageSize]="pageSize"
                (nzPageIndexChange)="onPageChange($event)" nzShowSizeChanger [nzPageSizeOptions]="[10, 20, 50]">
            </nz-pagination>
        </div>
    </div>

    <nz-modal [(nzVisible)]="isModalVisible" [nzTitle]="isEditing ? 'Edit Credential' : 'Add Credential'"
        (nzOnCancel)="closeModal()" (nzOnOk)="save()" [nzOkLoading]="saving">
        <div *nzModalContent>

            <form nz-form [formGroup]="form">
                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="name">Name</nz-form-label>
                    <nz-form-control [nzSpan]="24">
                        <input nz-input id="name" formControlName="name" />
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="type">Type</nz-form-label>
                    <nz-form-control [nzSpan]="24">
                        <input nz-input id="type" formControlName="type" />
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="value">Value</nz-form-label>
                    <nz-form-control [nzSpan]="24">
                        <input nz-input id="value" formControlName="value" />
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="metadata">Metadata</nz-form-label>
                    <nz-form-control [nzSpan]="24">
                        <textarea nz-input id="metadata" formControlName="metadata" rows="4"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </form>
        </div>
    </nz-modal>
</div>