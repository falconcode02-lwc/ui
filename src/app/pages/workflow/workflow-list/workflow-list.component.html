<nz-page-header class="page-action">
    <nz-page-header-title><nz-icon nzType="pull-request" nzTheme="outline"></nz-icon> Workflows</nz-page-header-title>
    <nz-page-header-subtitle>
        <!-- <input nz-input placeholder="Search workflows..." [(ngModel)]="searchText"
            (input)="search()" style="width: 250px; margin-right: 12px" /> -->


        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
            <input type="text" (input)="search()" [(ngModel)]="searchText" nz-input placeholder="Search workflows..." />
        </nz-input-group>
        <ng-template #suffixIconButton>
            <button nz-button nzType="primary" (click)="search()" nzSearch> <nz-icon nzType="search"></nz-icon></button>
        </ng-template>
    </nz-page-header-subtitle>
    <nz-page-header-extra>


        <nz-space>
            <button *nzSpaceItem nz-button nzType="default" nzShape="round" (click)="loadWorkflows()">
                <i nz-icon nzType="reload"></i> Refresh
            </button>
            <button *nzSpaceItem nz-button nzType="default" nzShape="round" (click)="openImportModal()">
                <i nz-icon nzType="import"></i> Import
            </button>
            <button *nzSpaceItem nz-button nzType="default" nzShape="round" (click)="newWorkflow()">
                <i nz-icon nzType="plus"></i> New
            </button>
        </nz-space>
    </nz-page-header-extra>
</nz-page-header>



<div class="workflow-list">
    <!-- Empty State -->
    <nz-empty *ngIf="!loading && filteredWorkflows.length === 0" nzNotFoundContent="No workflows found">
        <button nz-button nzType="primary" (click)="newWorkflow()">
            <i nz-icon nzType="plus"></i> Create Workflow
        </button>
    </nz-empty>

    <!-- List View -->
    <nz-list *ngIf="filteredWorkflows.length > 0" [nzDataSource]="filteredWorkflows" [nzLoading]="loading" nzBordered>
        <nz-list-item *ngFor="let w of filteredWorkflows" class="workflow-item">
            <div class="workflow-content">
                <div class="workflow-main" (click)="edit(w)">
                    <nz-icon nzType="pull-request" nzTheme="outline" class="workflow-icon"></nz-icon>
                    <div class="workflow-details">
                        <div class="workflow-name">{{ w.name }}</div>
                        <div class="workflow-meta">
                            <span class="meta-item">
                                <span class="meta-label">Code:</span> {{ w.code }}
                            </span>
                            <span class="meta-item" *ngIf="w.description">
                                <span class="meta-label">|</span> {{ w.description }}
                            </span>
                            <span class="meta-item">
                                <span class="meta-label">|</span> Created <small><i>{{ w.createdTime |
                                        date:constants.dateformat
                                        }}</i></small>
                                <span class="meta-label">|</span> Updated <small><i> {{ w.modifiedTime |
                                        date:constants.dateformat
                                        }}</i></small>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="workflow-actions">
                    <nz-switch [(ngModel)]="w.active" (ngModelChange)="onActiveChange($event, w)"
                        [nzCheckedChildren]="'Active'" [nzUnCheckedChildren]="'Inactive'">
                    </nz-switch>

                    <button nz-button nzType="text" nz-dropdown [nzDropdownMenu]="menu" nzPlacement="bottomRight"
                        (click)="$event.stopPropagation()">
                        <nz-icon nzType="more" nzTheme="outline"></nz-icon>
                    </button>
                    <nz-dropdown-menu #menu="nzDropdownMenu">
                        <ul nz-menu>
                            <li nz-menu-item (click)="exportWorkflow(w, $event)">
                                <nz-icon nzType="export" nzTheme="outline"></nz-icon>
                                Export
                            </li>
                            <li nz-menu-item nzDanger (click)="delete(w)">
                                <nz-icon nzType="delete" nzTheme="outline"></nz-icon>
                                Delete
                            </li>
                        </ul>
                    </nz-dropdown-menu>
                </div>
            </div>
        </nz-list-item>
    </nz-list>
</div>

<!-- Import Modal -->
<nz-modal [(nzVisible)]="isImportModalVisible" nzTitle="Import Workflow" [nzFooter]="null" [nzWidth]="920"
    (nzOnCancel)="closeImportModal()">
    <ng-container *nzModalContent>
        <app-workflow-import (onImportComplete)="onImportComplete($event)" (onCancel)="closeImportModal()">
        </app-workflow-import>
    </ng-container>
</nz-modal>